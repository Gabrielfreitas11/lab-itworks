(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{handle:()=>C,productsByEAN:()=>O});const r=require("@babel/runtime/helpers/asyncToGenerator");var n=e.n(r);class o{static ok(e){return{statusCode:200,body:e}}static created(e){return{statusCode:201,body:e}}static notFound(e){return{statusCode:404,body:e}}static badRequest(e){return{statusCode:400,body:e}}static serverError(e){return{statusCode:500,body:e}}}const s=require("@babel/runtime/helpers/defineProperty");var a=e.n(s);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class c{constructor(){this.event=null,this.context=null,this.env=process.env}handle(e,t,r){var o=arguments,s=this;return n()((function*(){var n=!(o.length>3&&void 0!==o[3])||o[3];if(s.setFunctionContext(e,t),!(yield s.isAuthorized()))return c.httpResponse(401,JSON.stringify({statusCode:401,message:"Unauthorized!"}));try{var a=yield s[r](e);if(!n)return a;var u="string"==typeof a.body?a.body:JSON.stringify(a.body);return c.httpResponse(a.statusCode,u,a.headers)}catch(e){var i=e.response&&e.response.data?e.response.data:e.message||e;return c.httpResponse(500,i)}}))()}setFunctionContext(e,t){this.event=e,this.context=t,process.env.sourceIpAddress=e.requestContext&&e.requestContext.identity&&e.requestContext.identity.sourceIp?e.requestContext.identity.sourceIp:null}static httpResponse(e,t){return{statusCode:e,body:t,headers:i({"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*"},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}}isAuthorized(){var e={header:this.authHeaderIsTheSameInTheEnvironment()}[this.env.authMethod];return void 0===e||e}authHeaderIsTheSameInTheEnvironment(){return this.event.headers.Authorization===this.env.authToken}}const l=function(){var e=n()((function*(e,t,r,n){var o=new class extends c{};return o[n]=r,o.handle(e,t,n)}));return function(t,r,n,o){return e.apply(this,arguments)}}(),d=require("@hapi/joi");var p=e.n(d),h=p().object({product:p().string().required()});require("openai");const y=require("cheerio"),v=require("axios");var f=e.n(v);function b(){return b=n()((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t&&t.httpsAgent?t:e;return f()(r).then(function(){var e=n()((function*(e){return e}));return function(t){return e.apply(this,arguments)}}(),function(){var e=n()((function*(e){throw e}));return function(t){return e.apply(this,arguments)}}())})),b.apply(this,arguments)}var g=function(){var e=n()((function*(e){var t;try{var r={url:"https://pt.product-search.net/?q=".concat(e),method:"GET",headers:{"Content-Type":"text/html","Access-Control-Allow-Origin":"*"}},n=yield function(e){return b.apply(this,arguments)}(r),o=(t=n.data,(0,y.load)(t));console.log(o("p").text()),console.log(o("tbody").text());var s=o("p").text().split("EAN"),a="";return s.forEach((t=>{t.includes(e)&&(a=t.replace(e,""))})),a.trim()}catch(e){throw console.log(e),null}}));return function(t){return e.apply(this,arguments)}}();function m(){return(m=n()((function*(e){var{product:t}=e;return yield g(t)}))).apply(this,arguments)}var O=function(){var e=n()((function*(e){var{body:t}=e;try{console.log(t);var r=function(e){if(!e)return{error:!0,message:"Faltando par칙metros obrigat칩rios"};var t=h.validate(e);return t.error?{error:!0,message:"O seguinte par칙metro est치 faltando ou incorreto: ".concat(t.error.details[0].path[0])}:{value:t.value,error:!1}}(JSON.parse(t));if(r.error)return o.badRequest({message:r.message});var n=yield function(e){return m.apply(this,arguments)}(r.value);return o.ok({message:n})}catch(e){return o.serverError({message:(null==e?void 0:e.message)||"Problemas ao consultar mensagem"})}}));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=n()((function*(e,t){return l(e,t,O,"productsByEAN")}));return function(t,r){return e.apply(this,arguments)}}();module.exports=t})();
//# sourceMappingURL=index.js.map