{"version":3,"file":"src/controllers/base64ToFile/index.js","mappings":"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","sources":["webpack://node/webpack/bootstrap","webpack://node/webpack/runtime/compat get default export","webpack://node/webpack/runtime/define property getters","webpack://node/webpack/runtime/hasOwnProperty shorthand","webpack://node/webpack/runtime/make namespace object","webpack://node/external commonjs \"@babel/runtime/helpers/asyncToGenerator\"","webpack://node/./common/httpResponse.js","webpack://node/external commonjs \"@hapi/joi\"","webpack://node/./src/controllers/base64ToFile/validations/schema.js","webpack://node/external commonjs \"@babel/runtime/helpers/defineProperty\"","webpack://node/./common/handler/BaseController.js","webpack://node/./common/handler/handle.js","webpack://node/external commonjs \"aws-sdk\"","webpack://node/./common/aws/s3.js","webpack://node/./src/controllers/base64ToFile/functions/uploadFile.js","webpack://node/./src/controllers/base64ToFile/index.js","webpack://node/./src/controllers/base64ToFile/validations/validator.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/asyncToGenerator\");","export default class HttpResponse {\r\n  static ok(body) {\r\n    return {\r\n      statusCode: 200,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static created(body) {\r\n    return {\r\n      statusCode: 201,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static notFound(body) {\r\n    return {\r\n      statusCode: 404,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static badRequest(body) {\r\n    return {\r\n      statusCode: 400,\r\n      body,\r\n    };\r\n  }\r\n\r\n  static serverError(body) {\r\n    return {\r\n      statusCode: 500,\r\n      body,\r\n    };\r\n  }\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@hapi/joi\");","import Joi from '@hapi/joi';\n\nexport const schema = Joi.object({\n  base64: Joi.string().required(),\n  fileName: Joi.string().required(),\n  client: Joi.string().required(),\n  ano: Joi.string().required(),\n  fileType: Joi.string().default('xml'),\n  mes: Joi.string()\n    .valid(\n      'janeiro',\n      'fevereiro',\n      'março',\n      'abril',\n      'maio',\n      'junho',\n      'julho',\n      'agosto',\n      'setembro',\n      'outubro',\n      'novembro',\n      'dezembro',\n    )\n    .required(),\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","export default class BaseController {\n  event = null;\n\n  context = null;\n\n  env = process.env;\n\n  async handle(event, context, method, isHttpResponse = true) {\n    this.setFunctionContext(event, context);\n\n    if (!(await this.isAuthorized())) {\n      return BaseController.httpResponse(\n        401,\n        JSON.stringify({\n          statusCode: 401,\n          message: 'Unauthorized!',\n        }),\n      );\n    }\n\n    try {\n      const response = await this[method](event);\n\n      if (!isHttpResponse) return response;\n\n      const body = typeof response.body === 'string'\n        ? response.body\n        : JSON.stringify(response.body);\n      return BaseController.httpResponse(\n        response.statusCode,\n        body,\n        response.headers,\n      );\n    } catch (err) {\n      const message = err.response && err.response.data\n        ? err.response.data\n        : err.message || err;\n\n      return BaseController.httpResponse(500, message);\n    }\n  }\n\n  setFunctionContext(event, context) {\n    this.event = event;\n    this.context = context;\n\n    process.env.sourceIpAddress = event.requestContext\n      && event.requestContext.identity\n      && event.requestContext.identity.sourceIp\n      ? event.requestContext.identity.sourceIp\n      : null;\n  }\n\n  static httpResponse(statusCode, body, headers = {}) {\n    return {\n      statusCode,\n      body,\n      headers: {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': '*',\n        ...headers,\n      },\n    };\n  }\n\n  isAuthorized() {\n    const checkByAuthMethod = {\n      header: this.authHeaderIsTheSameInTheEnvironment(),\n    }[this.env.authMethod];\n\n    if (checkByAuthMethod === undefined) {\n      return true;\n    }\n\n    return checkByAuthMethod;\n  }\n\n  authHeaderIsTheSameInTheEnvironment() {\n    return this.event.headers.Authorization === this.env.authToken;\n  }\n\n  /**\n   * @author Victor Hugo Lemos Mattar & Sandrão\n   * @param {*} context\n   * @returns {string}\n   */\n\n  /**\n   * @author Will Saymon & Victor Hugo Lemos Mattar\n   * @param {*} context\n   * @returns {string}\n   */\n}\n","import BaseController from './BaseController';\n\nexport default async (event, context, func, funcName) => {\n  const Controller = class extends BaseController {};\n  const handler = new Controller();\n  handler[funcName] = func;\n  return handler.handle(event, context, funcName);\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"aws-sdk\");","import aws from 'aws-sdk';\n\nconst methods = {\n  async getContentFile(bucketName, keyName) {\n    const params = {\n      Bucket: bucketName,\n      Key: keyName,\n    };\n\n    const s3sdk = new aws.S3();\n\n    return s3sdk.getObject(params).promise();\n  },\n\n  async sendFile(fileDetails, expires, acl = 'public-read') {\n    const params = {\n      Bucket: fileDetails.bucket,\n      Key: fileDetails.caption,\n      ContentType: fileDetails.contentType,\n      ContentDisposition: fileDetails.contentDisposition,\n      Body: fileDetails.buffer,\n      ACL: acl,\n    };\n\n    if (expires) {\n      params.Expires = expires;\n    }\n\n    const s3sdk = new aws.S3();\n\n    return s3sdk.upload(params).promise();\n  },\n\n  async listFiles(fileDetails) {\n    const s3sdk = new aws.S3();\n\n    const params = {\n      Bucket: fileDetails.bucket,\n      Prefix: fileDetails.key,\n\n    };\n\n    return s3sdk.listObjectsV2(params).promise();\n  },\n\n  async deleteFile(params) {\n    const s3sdk = new aws.S3();\n\n    return s3sdk.deleteObject(params).promise();\n  },\n};\n\nconst s3 = () => {\n  aws.config.update({\n    accessKeyId: process.env.accessKeyId,\n    secretAccessKey: process.env.secretAccessKey,\n    region: process.env.region,\n  });\n\n  return methods;\n};\n\nexport default s3;\n","import S3 from '../../../../common/aws/s3';\n\nconst s3Access = S3();\n\nexport async function uploadFile({\n  fileName, client, ano, mes, base64, fileType,\n}) {\n  const params = {\n    bucket: 'emalote',\n    caption: `${client}/${ano}/${mes}/${fileName}.${fileType}`,\n    contentType: `application/${fileType}`,\n    contentDisposition: 'inline',\n    buffer: Buffer.from(base64, 'base64'),\n  };\n\n  const upload = await s3Access.sendFile(params);\n\n  return upload && upload.Location ? upload.Location : '';\n}\n","import HttpResponse from '../../../common/httpResponse';\n\nimport { isValidParams } from './validations/validator';\n\nimport handleFunction from '../../../common/handler/handle';\n\nimport { uploadFile } from './functions/uploadFile';\n\nexport const base64ToFile = async ({ body }) => {\n  try {\n    const params = isValidParams(JSON.parse(body));\n\n    if (params.error) {\n      return HttpResponse.badRequest({\n        message: params.message,\n      });\n    }\n\n    const file = await uploadFile(params.value);\n\n    return HttpResponse.ok({\n      file,\n    });\n  } catch (error) {\n    // console.log(error);\n\n    return HttpResponse.serverError({\n      message: error?.message || 'Problemas ao gerar arquivo',\n    });\n  }\n};\n\nexport const handle = async (event, context) => handleFunction(event, context, base64ToFile, 'base64ToFile');\n","import { schema } from './schema';\r\n\r\nexport function isValidParams(params) {\r\n  if (!params) {\r\n    return {\r\n      error: true,\r\n      message: 'Faltando parâmetros obrigatórios',\r\n    };\r\n  }\r\n\r\n  const result = schema.validate(params);\r\n  if (result.error) {\r\n    return {\r\n      error: true,\r\n      message: `O seguinte parâmetro está faltando ou incorreto: ${result.error.details[0].path[0]}`,\r\n    };\r\n  }\r\n\r\n  return {\r\n    value: result.value,\r\n    error: false,\r\n  };\r\n}\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","require","HttpResponse","static","body","statusCode","schema","Joi","base64","required","fileName","client","ano","fileType","default","mes","valid","BaseController","constructor","event","context","env","process","handle","method","_arguments","arguments","_this","_asyncToGenerator","isHttpResponse","length","undefined","setFunctionContext","isAuthorized","httpResponse","JSON","stringify","message","response","headers","err","data","this","sourceIpAddress","requestContext","identity","sourceIp","_objectSpread","checkByAuthMethod","header","authHeaderIsTheSameInTheEnvironment","authMethod","Authorization","authToken","_ref","func","funcName","handler","_x","_x2","_x3","_x4","apply","methods","getContentFile","bucketName","keyName","params","Bucket","Key","aws","getObject","promise","sendFile","fileDetails","expires","acl","bucket","caption","ContentType","contentType","ContentDisposition","contentDisposition","Body","buffer","ACL","Expires","upload","listFiles","s3sdk","Prefix","listObjectsV2","deleteFile","deleteObject","s3Access","accessKeyId","secretAccessKey","region","_uploadFile","concat","Buffer","from","Location","base64ToFile","_ref2","error","result","validate","details","path","isValidParams","parse","badRequest","file","uploadFile","ok","serverError","_ref3","handleFunction"],"sourceRoot":""}